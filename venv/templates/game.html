<html>
<head>
    <title>Flask Tutorial</title>
    <style>
        button {
            width: 50px;
            height: 50px;
        }
        p {
            display: flex;
        }
        .main {
            display: block;
            margin-left: auto;
            margin-right: auto;
            width: 40%;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script>
        function setSomething(id){
            const foo = document.getElementById("gameId").innerHTML.split(' ')[1];
            fetch('http://127.0.0.1:5000/setSomething', {
                method: 'POST',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ "field": id, "gameId":foo })
            })
                .then(response => response.json())
                .then(async response => {
                    console.log(JSON.stringify(response));
                    await updateDiv(id);
                    await allertWinner(response['winner']);
                })

            console.log();
        }

        async function allertWinner(winner){
            if (winner !== null) {
                console.log(winner);
                document.getElementById("winner").innerHTML = document.getElementById("winner").innerHTML + `${winner}`;
            }
        }

        async function updateDiv()
        {
            $( "#playground" ).load(window.location.href + " #playground" );
        }

    </script>
</head>
<body>
<h1>Lets Play TicTacToe</h1>
<br>
<h1>Player1: {{game['player1Name']}}</h1>
<h1>Player2: {{game['player2Name']}}</h1>
<h1 id="gameId">gameId: {{game['gameId']}}</h1>
<div class="main">
    <h1 id="winner">Winner: </h1>
    <div id="playground">
        <h1>current player: {{game['currentPlayerName']}}</h1>
        {% for row in game['grid'] %}
        {% set rowIndex = loop.index -1 %}
        <p>
            {% for col in row %}
            {% set colIndex = loop.index -1 %}
            {% set id = rowIndex,colIndex %}
            {% set gameId = game['gameId'] %}
            {% set winner = game['winner'] %}
                {% if col.isEnabled %}
                    <button id="{{id}}" onclick="setSomething(this.id)">{{col['value']}}</button>
                {% else %}
                    <button id={{rowIndex,colIndex}} onclick="setSomething(this.id)" disabled>{{col['value']}}</button>
                {% endif %}
            {% endfor %}
        </p>
        {% endfor %}
    </div>
</div>
</body>
</html>